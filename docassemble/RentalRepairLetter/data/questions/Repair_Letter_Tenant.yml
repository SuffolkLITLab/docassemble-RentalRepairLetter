include:
  - docassemble.MAVirtualCourt:basic-questions.yml
---
comment: |
  The metadata section controls the tab title and saved interview title. You can delete this section if you include this YAML file in another YAML file.
metadata:
  title: |
    Tenant Repair Letter
  short title: |
    Repair Letter
---
code: |
  interview_short_title = "Ask your landlord to fix bad housing conditions"
---
comment: |
  This section is used by MAVirtualCourts to control how some of the questions work.
mandatory: True
code: |
  interview_metadata # make sure we initialize the object
  if not defined("interview_metadata['tenant_repair_request']"):
    interview_metadata.initializeObject('tenant_repair_request')
  interview_metadata['tenant_repair_request'].update({
    'title': 'Tenant Repair Request Letter',
    'short title': 'Tenant Repair Request Letter',
    'description': 'Tenant Repair Request Letter',
    'original_form': '',
    'allowed courts': [
      'Boston Municipal Court',
      'District Court',
      'Housing Court',
      'Superior Court',
    ],
    'categories': [
      'Housing',
    ],
    'logic block variable': 'tenant_repair_request',
    'attachment block variable': 'tenant_repair_request',
    'typical role': 'plaintiff',
  })
---
features:
  navigation: True
---
sections:
  - review_tenant_repair_request: Review your answers
---
id: interview_order_tenant_repair_request
code: |
  # This is a placeholder to control logic flow in this interview
  custom_intro
  tenant_repair_request_intro
  Letter_Information
  # Set the allowed courts for this interview
  # Set the answer file name.
  user_role = 'plaintiff'
  set_parts(subtitle=str(users))
  set_progress(12.5)
  users[0]
  users[0].address
  users[0].address.zip
  users[0].phone_number
  set_progress(25.0)
  other_parties[0].name.first
  other_parties[0].address.address
  issue_date
  issue_description
  set_progress(37.5)
  # Save (anonymized) interview statistics.
  store_variables_snapshot(data={'zip': users[0].address.zip})
  preview_screen
  users[0].signature
  tenant_repair_request = True
  basic_questions_intro_screen = False
---
id: custom intro screen
mandatory: True
decoration: form-lineal
question: |
  Send a Repair Demand Letter to Your Landlord: Mass Access Project
subquestion: |
  
  The MassAccess Project can help Massachusetts tenants write and send letters in 3 steps:
  
  Step 1. Answer the questions that will fill out your letter.  
  Step 2. Review and sign the form.  
  Step 3. Step 3. Download or email the final form. You will need to deliver it on your own.
 
  
    *This site is not a lawyer. If you would like a lawyer, find [your local
  legal aid provider](https://www.lsc.gov/what-legal-aid/find-legal-aid).*
  
  Tap the {green words} in any screen for a definition or more information.
  

  % if chat_partners_available().help:
  Live help is currently available in this interview. Click the speech bubble
  (:comment-alt:) in the navigation bar to connect to a live advocate for help.
  % endif

fields:
  - To continue, you must accept the [terms of use](https://massaccess.suffolklitlab.org/privacy/): acknowledged_information_use
    datatype: checkboxes
    none of the above: False    
    minlength: 1
    choices:
      - I accept the terms of use.
    validation messages:
      minlength: |
        You cannot continue unless you agree to the terms of use.        
continue button field: custom_intro
terms:
  green words: |
    Green words are legal terms or a short way of referring to something that needs more explanation. The definition or explanation pops up when you tap the green words.
right: |
  % if user_has_saved_answers:
  ${fa_icon("bell", color="primary", size="sm")}
  Saved answers available!  
  
  ${action_button_html(url_action('load_answer'), icon="folder-open", label=word("View answers"), size="sm" )}
  % endif    
  
  
  Tap the {green words} in any screen for a definition or more information.

  % if chat_partners_available().help:
  Live help is currently available in this interview. Click the speech bubble
  (:comment-alt:) in the navigation bar to connect to a live advocate for help.
  % endif
---
id: Tenant Repair Letter
continue button field: tenant_repair_request_intro
question: |
  Tenant Repair Letter
subquestion: |

  This form will help you draft a notice letter to send to your landlord if they need to repair something in your apartment. If your landlord does not comply with this request, you may send them [Form 10 Repair Demand Letter](https://www.masslegalhelp.org/housing/lt1-form-10-repair-demand.pdf).  
  
  Before you start, you will need information about your landlord and their address.
  
  *The [Cour Forms Online](https://courtformsonline.org/housing/) project may be able to help with other housing issues.* 
  
help:
  label: |
    More information
  content: |
    Learn more at [MassLegalHelp.org](https://www.masslegalhelp.org/housing/forms/evictions-shortcut) 
mandatory: True
---
id: Letter information
continue button field: Letter_Information
question: |
  Information about mailing
fields:
  - How do you plan to mail this letter?: mailing_method
    datatype: radio
    choices:
      - Certified mail: certified_mail
      - Regular mail only: regular_mail
  - note: |
      **Great choice.**
      Certified mail is a good choice to make sure your landlord gets
      your letter. Bring this letter to the post office. Before you close
      the envelope, write the certified mail number on your letter. Keep
      a copy for your own records, too.
    show if:
      variable: mailing_method
      is: certified_mail
  - 'When are you sending this letter?': sent_date
    datatype: date
    default: ${ today().format("YYYY-MM-dd") }
---
id: Review your form before you sign it
continue button field: preview_screen
question: |
  Review your form before you sign it
subquestion: |

  Here is a preview of the form you'll sign on the next page.
  
   ${pdf_concatenate(tenant_repair_request_attachment, filename='tenant_repair_request.pdf')}
---
id: Date Issues arose
continue button field: Date_Issues_arose
question: |
  When did the issue begin
subquestion: |
  Give the approximate date if you do not know the exact date. 
fields:
  - 'Date Issue(s) Arose:': issue_date
    datatype: date
---
id: Issues
question: |
  Describe your issue
subquestion: |
  Give a specific description of the things(s) you need repaired.
fields:
  - 'Issues:': issue_description
    input type: area
---
id: Land Lord info 1
question: |
  Land Lord Information
fields:
  - Land Lord: other_parties[i].name.first
  - Land Lord Last Name: other_parties[i].name.last
    required: False 
---
id: Land Lord info
if: |
 land_lord_type == 'Person'
question: |
  Land Lord Information
First Name: other_parties[i].name.first
Last Name: other_parties[i].name.last
---
objects:
  - users: PeopleList.using(ask_number=True, target_number=1) # You can do the same thing for land_lord
  - other_parties: PeopleList.using(ask_number=True, target_number=1)
---
progress: 100
mandatory: True
id: Your form is ready to download and file
question: |
  Your lettter is ready to download
subquestion: |
  Thank you ${users}. Your form is ready to download and deliver.
  
   1. Look over the letter below. Click the "[Review your answers](${ url_action('review_tenant_repair_request')})" button
  if you need to make any changes.
  2. Download and print 2 copies of your letter. Keep one for your records.
  Send the other copy to your housing authority.
  3. If you choose to send it by certified mail, bring your letter
  unsealed to the post office. Write the certified mail number on the letter
  before you place it in the mail.
  
  ${pdf_concatenate(tenant_repair_request_attachment['final'], filename='tenant_repair_request.pdf') }
need: tenant_repair_request
attachment code: tenant_repair_request_attachment['final']
---
objects:
  - tenant_repair_request_attachment: DADict
---
attachment:
    variable name: tenant_repair_request_attachment[i]
    name: Letter to request a grievance hearing
    filename: tenant_repair_request
    docx template file: tenant_repair_request.docx
---
id: tenant_repair_request review screen
event: review_tenant_repair_request
question: |
  Placeholder Review Screen
subquestion: |
  Edit your answers below
review: 
  - Edit: land_lord[0].address.address
    button: |
      land_lord[0].address.address:
      ${ land_lord[0].address.address }
  - Edit: users[0].signature
    button: |
      users[0].signature:
      ${ users[0].signature }
  - Edit: users[0].name.first
    button: |
      users[0]:
      ${ users[0] }
  - Edit: users[0].number
    button: |
      users[0].number:
      ${ users[0].number }
  - Edit: signature_date
    button: |
      signature_date:
      ${ signature_date }
  - Edit: land_lord[0].name.first
    button: |
      land_lord[0]:
      ${ land_lord[0] }
  - Edit: users[0].address
    button: |
      users[0].address:
      ${ users[0].address }
  - Edit: land_lord[0].address
    button: |
      land_lord[0].address:
      ${ land_lord[0].address }
  - Edit: users[0].address.address
    button: |
      users[0].address.address:
      ${ users[0].address.address }
---
id: your name
question:  |
  What is your name?
fields:
  - First Name: users[0].name.first
  - Middle Name: users[0].name.middle
    required: False
  - Last Name: users[0].name.last
  - Suffix: users[0].name.suffix
    code: |
      name_suffix()
    required: False
---
id: persons address
generic object: Individual
question: |
  What is your address
fields:
  - Street Address: users[0].address.address
    address autocomplete: True
  - Unit: users[0].address.unit
    required: False
  - City: users[0].address.city
  - State: users[0].address.state
    default: MA   
    code: |
      states_list()   
  - Zip Code: users[0].address.zip
    required: False
---
id: your contact information
question: |
  Contact information
subquestion: |
  What is the best way for your landlord to reach you? 
fields:  
  - Mobile number: users[0].mobile_number
    required: False
  - Other phone number: users[0].phone_number
    required: False
  - Email address: users[0].email    
    datatype: email
    required: False
  - Other ways to reach you: users[0].other_contact_method
    input type: area
    required: False
    help: |
      Be Specific 
validation code: |
  if (not showifdef('users[0].phone_number') and \
      (not showifdef('users[0].mobile_number')) and \
      (not showifdef('users[0].email')) and \
      (not showifdef('users[0].other_contact_method'))):
    validation_error(word("You need to provide at least one contact method."))
help: |
  Provide at least one way to reach you
---
code: signature_date = today()
---
id: signature choice
decoration: file-signature
question: |
  Sign your Letter 
subquestion: |
  Your letter is almost ready. You need to sign it first.
  
  Use the mouse or touchpad on your computer or
  sign with your finger on your phone. 
   
  You can send the letter to someone else to sign if you choose the "phone" option.
field: signature_choice
buttons:  
  - Sign on my phone: phone
    image: mobile-alt
  - Sign on this computer: this device
    image: desktop
continue button field: saw_signature_choice
script: |
  <script>
    $(".da-field-buttons > div > .btn-da-custom").last().after("<br>")
    $(".da-field-buttons > div > .btn-da-custom").first().before("<br>")
  </script>